## 2.4 对话式 AI 框架拆解 {#2-4-framework-breakdown}
在对话式 AI 的实际落地中，通常会有两条路径：**企业级方案**与**开源框架**。

前者强调**快速接入与稳定性**，例如声网推出的对话式 AI 引擎，帮助企业以更高效率将语音智能能力集成到业务系统中。而开源路径则更注重**编排灵活性与可扩展性**，让开发者能够自由探索不同的系统结构与模型组合。

在这里，我们将以开源生态中的代表 —— **[TEN Framework](https://github.com/TEN-framework/ten-framework)** 为例，拆解一个真实的对话式 AI 编排框架，看看它如何将抽象的系统理念落地为可运行的架构。

### 2.4.1 TEN Framework 的编排哲学 {#2-4-1-TEN-philosophy}
    

1. **图是契约**
    

TEN 的 **Graph** 规范清晰定义节点（extension）与它们的控制/数据/媒体连接。你可以在应用属性中定义**预设图**（支持 auto_start、singleton），也可以通过发送 start_graph 命令启动**动态图**。这意味着编排是**数据结构**，而非硬编码逻辑。

2. **控制面与媒体面分离**
    

每个扩展声明自己的 cmd_in/out、data_in/out、audio_frame_in/out、video_frame_in/out。框架通过消息名进行匹配，并自动管理**所有权与线程安全**。结果是，你无需手写 IPC 逻辑即可实现稳定的全双工音频。

3. **跨进程/线程实时可变**
    

TEN 支持**跨进程编排**与**运行时配置**。你可以进行 1→N 并行调用、N→1 聚合、或 N→M 链式拓扑——都可在不重新编译的情况下热切换。

4. **多语言与多部署形态**
    

扩展可使用 C/C++、Go、Python、JS/TS 等语言实现，可在单进程内并行运行，也可分布在不同机器间（边缘 + 云）。这让低延迟任务（如 VAD、轮次检测）驻留在边缘，而复杂推理留给云端 LLM。

5. **实时状态管理**
    

框架强调动态状态，使智能体能在会话中途自适应调整——这对打断处理、轮次切换、语速调节尤为重要。

6. **围绕图的一等工具链**
    

TEN 提供**图验证**工具（tman check graph）与 **TMAN Designer** 可视化低/无代码编辑器，可加载应用与图、可视化流程与日志——非常适合调试包含 STT→LLM→TTS 等复杂管线。

7. **语音原生积木**
    

TEN 内置开源的 **TEN VAD**（流式、低延迟）与 **TEN Turn Detection**（语义轮次检测，支持 EN/ZH，“等待/结束/未完成” 状态），显著减少误判与抢话。这些模型可像任意扩展一样直接插入你的图中。

### 2.4.2 对话式 AI 编排实例 {#2-4-2-orchestration-examples}
    

上面讲的是 TEN 在架构层面的设计原则。那这些机制在真实的对话管线中是怎样发挥作用的？下面两个例子可以帮助你更直观地理解语音编排的运行方式。

1. **实例一：经典 STT → LLM → TTS（全双工）**
    
最常见的 TEN 管线是全双工的语音对话：

```Plain
RTC In
  → VAD / Turn Detection
  → STT (流式)
  → LLM (Function Call + RAG)
  → TTS (流式)
  → RTC Out
```

整个过程流式进行。

当用户说话时，VAD 识别语音段并将帧流送入 STT；

STT 输出部分识别结果传给 LLM；

LLM 开始生成 token；

每个 token 实时触发 TTS 生成音频块返回给 RTC。

当用户在系统播放时插话，VAD 会检测到新的音频活动，TEN 会发出控制消息中止当前 TTS，取消 LLM 推理并切回监听状态。

所有这些逻辑都通过图定义完成，无需手写复杂的条件判断。


2. **实例二：实时 API 管线（Voice-to-Voice LLM）**
    

另一种架构使用实时多模态 API 替代传统 STT+LLM 组合：

```Plain
RTC In
  → Realtime API (LLM+ASR)
  → TTS
  → RTC Out
```

在这种模式下，语音识别与语言推理由一个端到端模型完成，TTS 模块只在必要时作为后备或声音克隆组件。即便架构更简单，开发者仍可在 TEN 图中挂载 VAD 和 Turn Detection 模块，以在实时流中实现打断控制和状态管理。

这种混合模式兼顾了端到端的流畅体验与编排系统的可控性。